<html>
<head>
    <title>Results Template</title>
    <style>
        /* Add your custom styles here */
        body {
            font-family: Calibri, sans-serif;
        }

        .title {
            text-align: center;
            margin: 20px 0;
        }

        .choice {
            text-align: center;
            margin-bottom: 30px;
        }

        .choice label {
            font-weight: bold;
        }

        .tables {
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .table {
            margin: 0 20px;
            width: 200px;
        }

        .table h3 {
            text-align: center;
            margin-top: 0;
        }

        .table table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .table th,
        .table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .table th {
            background-color: #f2f2f2;
        }

        .button-container {
            text-align: center;
            margin-top: 20px;
        }

        .button {
            display: inline-block;
            padding: 10px 20px;
            background-color: #f1f1f1;
            color: #333;
            text-decoration: none;
            border-radius: 4px;
            margin-right: 10px;
            transition: background-color 0.3s ease;
        }

        .button:hover {
            background-color: #ddd;
        }
        #myChart {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

    </style>
</head>
<body>
<div class="title">
    <h1>Results Template</h1>
</div>
<div class="tables">
    <div class="table">
        <h3>MA1</h3>
        <table id="ma1Table">
            <p>Number of Courses: <span id="ma1Count"></span></p>
            <thead>
                <tr>
                    <th>Course Name</th>
                    <th>Credits</th>
                </tr>
            </thead>
            <tbody>
                <!-- MA1 table content will be generated dynamically -->
            </tbody>
        </table>
    </div>
    <div class="table">
        <h3>MA2</h3>
        <table id="ma2Table">
            <p>Number of Courses: <span id="ma2Count"></span></p>
            <thead>
                <tr>
                    <th>Course Name</th>
                    <th>Credits</th>
                </tr>
            </thead>
            <tbody>
                <!-- MA2 table content will be generated dynamically -->
            </tbody>
        </table>
    </div>
    <div class="table">
        <h3>MA3</h3>
        <table id="ma3Table">
            <p>Number of Courses: <span id="ma3Count"></span></p>
            <thead>
                <tr>
                    <th>Course Name</th>
                    <th>Credits</th>
                </tr>
            </thead>
            <tbody>
                <!-- MA3 table content will be generated dynamically -->
            </tbody>
        </table>
    </div>
    <div class="table">
        <h3>MA4</h3>
            <table id="ma4Table">
                <p>Number of Courses: <span id="ma4Count"></span></p>
                <thead>
                    <tr>
                        <th>Course Name</th>
                        <th>Credits</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- MA4 table content will be generated dynamically -->
                </tbody>
            </table>
        </div>
    </div>
    <div class="button-container">
        <a href="#" class="button" onclick="downloadTablesAsPDF()">Download as PDF</a>
    </div>


    <script>
        // Retrieve the selected courses from session storage
        var ma1Courses = JSON.parse(sessionStorage.getItem("selectedCourses1"));
        var ma2Courses = JSON.parse(sessionStorage.getItem("selectedCourses2"));
        var ma3Courses = JSON.parse(sessionStorage.getItem("selectedCourses3"));
        var ma4Courses = JSON.parse(sessionStorage.getItem("selectedCourses4"));
        var counter = 0;
        var ma1Count = 0;
        var ma2Count = 0;
        var ma3Count = 0;
        var ma4Count = 0;

        // Function to update the course count
        function updateCourseCount(courses, countId) {
        var countElement = document.getElementById(countId);
        if (courses) {
            countElement.textContent = courses.length;
        } else {
            countElement.textContent = '0';
        }
        }

        // Update course count for each MA level
        updateCourseCount(ma1Courses, 'ma1Count');
        updateCourseCount(ma2Courses, 'ma2Count');
        updateCourseCount(ma3Courses, 'ma3Count');
        updateCourseCount(ma4Courses, 'ma4Count');


        // Function to generate table rows for a given course array
        function generateTableRows(courses, tableId, countId) {
            var table = document.getElementById(tableId);
            var count = document.getElementById(countId);

            // Clear existing rows
            table.innerHTML = "";

            // Create the table header row
            var thead = document.createElement("thead");
            var headerRow = thead.insertRow();
            var courseNameHeader = document.createElement("th");
            var creditsHeader = document.createElement("th");
            courseNameHeader.textContent = "Course Name";
            creditsHeader.textContent = "Credits";
            headerRow.appendChild(courseNameHeader);
            headerRow.appendChild(creditsHeader);
            table.appendChild(thead);

            // Create the table body
            var tbody = document.createElement("tbody");

            // Generate table rows for each course
            courses.forEach(function (course) {
                var row = tbody.insertRow();
                var nameCell = row.insertCell(0);
                var creditsCell = row.insertCell(1);
                nameCell.textContent = course.name;
                creditsCell.textContent = course.credits;
            });

            table.appendChild(tbody);

            // Update the count
            count.textContent = courses.length;
        }

    // Generate tables for each MA level
    if (ma1Courses) {
        generateTableRows(ma1Courses, "ma1Table", "ma1Count");
    }

    if (ma2Courses) {
        generateTableRows(ma2Courses, "ma2Table", "ma2Count");
    }

    if (ma3Courses) {
        generateTableRows(ma3Courses, "ma3Table", "ma3Count");
    }

    if (ma4Courses) {
        generateTableRows(ma4Courses, "ma4Table", "ma4Count");
    }



    function downloadTablesAsPDF() {
  var ma1Courses = JSON.parse(sessionStorage.getItem("selectedCourses1"));
  var ma2Courses = JSON.parse(sessionStorage.getItem("selectedCourses2"));
  var ma3Courses = JSON.parse(sessionStorage.getItem("selectedCourses3"));
  var ma4Courses = JSON.parse(sessionStorage.getItem("selectedCourses4"));

  // Create an empty PDF document
  var doc = new jsPDF();

  // Set font styles
  doc.setFont("Arial", "normal");

  // Create a cover page with EPFL title and program name
  doc.setTextColor("#FF0000");
  doc.setFontSize(40);
  doc.setFontStyle("bold");
  doc.text("EPFL", doc.internal.pageSize.getWidth() / 2, doc.internal.pageSize.getHeight() / 2, { align: "center" });
  doc.addPage(); // Add a new page for the course list

  // Set copyright footer
  var footerText = "Â© 2023 MasterPlan. All rights reserved.";
  doc.setFont("Calibri", "normal");

  // Print MA1 courses
  doc.addPage();
  doc.setFontSize(20);
  doc.setTextColor("#000000");
  doc.setFontStyle("bold");
  doc.text("MA1 - Total Credits: " + getTotalCredits(ma1Courses), 10, 20);
  doc.setTextColor("#000000");
  doc.setFontSize(12);
  printCourseList(doc, ma1Courses, 10, 30);
  doc.setTextColor("#666666");
  doc.setFontSize(10);
  doc.text(footerText, 10, doc.internal.pageSize.getHeight() - 10, { align: "left" });

  // Print MA2 courses
  doc.addPage();
  doc.setFontSize(20);
  doc.setTextColor("#000000");
  doc.setFontStyle("bold");
  doc.text("MA2 - Total Credits: " + getTotalCredits(ma2Courses), 10, 20);
  doc.setTextColor("#000000");
  doc.setFontSize(12);
  printCourseList(doc, ma2Courses, 10, 30);
  doc.setTextColor("#666666");
  doc.setFontSize(10);
  doc.text(footerText, 10, doc.internal.pageSize.getHeight() - 10, { align: "left" });

  // Print MA3 courses
  doc.addPage();
  doc.setFontSize(20);
  doc.setTextColor("#000000");
  doc.setFontStyle("bold");
  doc.text("MA3 - Total Credits: " + getTotalCredits(ma3Courses), 10, 20);
  doc.setTextColor("#000000");
  doc.setFontSize(12);
  printCourseList(doc, ma3Courses, 10, 30);
  doc.setTextColor("#666666");
  doc.setFontSize(10);
  doc.text(footerText, 10, doc.internal.pageSize.getHeight() - 10, { align: "left" });

  // Print MA4 courses
  doc.addPage();
  doc.setFontSize(20);
  doc.setTextColor("#000000");
  doc.setFontStyle("bold");
  doc.text("MA4 - Total Credits: " + getTotalCredits(ma4Courses), 10, 20);
  doc.setTextColor("#000000");
  doc.setFontSize(12);
  printCourseList(doc, ma4Courses, 10, 30);
  doc.setTextColor("#666666");
  doc.setFontSize(10);
  doc.text(footerText, 10, doc.internal.pageSize.getHeight() - 10, { align: "left" });

  doc.addPage();
  doc.setTextColor("#000000");
  doc.setFontSize(12);
  doc.text("Wishing you luck!", 10, 180);
  doc.setTextColor("#666666");
  doc.setFontSize(10);
  doc.text(footerText, 10, doc.internal.pageSize.getHeight() - 10, { align: "left" });

  // Save the PDF document
  doc.save("courses.pdf");
}


// Utility function to generate a course list string
function printCourseList(doc, courses, x, y) {
    var lineHeight = 8; // Adjust this value to increase/decrease the line height
    for (var i = 0; i < courses.length; i++) {
        var course = courses[i];
        var credits = course.credits.toString();
        var creditsPadding = " ".repeat(3 - credits.length); // Adjust the padding based on the number of digits in credits
        doc.text(course.name, x, y + (lineHeight * i));
        doc.text(credits + " credits", x + 100, y + (lineHeight * i));
    }
}

// Utility function to calculate the total credits for a given set of courses
function getTotalCredits(courses) {
    var totalCredits = 0;
    for (var i = 0; i < courses.length; i++) {
        var course = courses[i];
        totalCredits += course.credits;
    }
    return totalCredits;
}
 </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    

        
        <canvas id="myChart" style="margin-top: 30px; align-self: center ;" ></canvas>
      
        <script>
          // Chart.js code here
          var ma1Courses = JSON.parse(sessionStorage.getItem("selectedCourses1"));
          var ctx = document.getElementById('myChart').getContext('2d');
          var myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
              labels: ['MA1', 'MA2', 'MA3', 'MA4'],
              datasets: [{
                data: [getTotalCredits(ma1Courses), getTotalCredits(ma2Courses), getTotalCredits(ma3Courses), getTotalCredits(ma4Courses)],
                backgroundColor: [
                  'rgba(136, 8, 8, 0.2)',
                  'rgba(238, 75, 43, 0.2)',
                  'rgba(199, 0, 57 , 0.2)',
                  'rgba(88, 24, 69, 0.2)',
                  'rgba(153, 102, 255, 0.2)',
                  'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                  'rgba(136, 8, 8, 1)',
                  'rgba(238, 75, 43, 1)',
                  'rgba(199, 0, 57 , 1)',
                  'rgba(88, 24, 69, 1)',
                  'rgba(153, 102, 255, 1)',
                  'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
              }]
            },
          });
        </script>
</body>
</html>



